#!/bin/sh

SEC=300
AUDIO_FORMAT="cd"
VLC_STREAM="http://localhost:554"

echo "Starting continuous recording and streaming..."

while true; do
    OUTPUT_FILE="$(date +%Y-%m-%d__%H_%M).wav"
    arecord -f "$AUDIO_FORMAT" --max-file-time "$SEC" "$OUTPUT_FILE" | \
        cvlc -I dummy --sout "#transcode{acodec=mp3,ab=128,channels=2}:duplicate{dst=std{access=http,mux=raw,dst=$VLC_STREAM}}" &
    wait
done
